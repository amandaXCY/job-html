const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const { globalObjectKey, projType } = require('../constants.js');
const { hostPage, jsLibs, tmplData, entry, projectType } = global[globalObjectKey];

const basicConf = {
  template: hostPage || path.resolve(__dirname, '../index.html'),
  filename: 'index.html',
  inject: 'body',
  // chunksSortMode: function(a, b) {
  //   var order = ['webpack-bootstrap', 'vendors', 'common', 'main'];
  //   return order.indexOf(a.names[0]) - order.indexOf(b.names[0]);
  // },
  //上面这段sort好像不需要了，那就去掉吧
  templateParameters: {
    jsLibs, tmplData
  }
};

if (projectType === projType.mpa && typeof entry === 'object') {
    let chunks = Object.keys(entry);
    module.exports = chunks.map(chunk => {
        return new HtmlWebpackPlugin(Object.assign({}, basicConf, {
            chunks: [chunk],
            filename: chunk.split('/')[0] + '/index.html'
        }))
    })
} else {
  module.exports = [new HtmlWebpackPlugin(basicConf)];
}
